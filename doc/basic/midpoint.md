# 取中点相关技巧

## 不会溢出的取中点操作

https://zhuanlan.zhihu.com/p/144589742

https://www.zhihu.com/question/285586045/answer/481988416

## 恰好扫描数组一半的长度

对长度为n的数组, 扫描一半的长度, 直接用`n / 2`是不行的.  
但是`(n + 1) / 2`取开区间和`(n - 1) / 2`取闭区间都是可以的.

以取前半段为例, 直接给出表格, 自行观察一下.

| n的取值 | n为odd时              | n为even时             |
| ------- | --------------------- | --------------------- |
| n       | \[0, n / 2\]          | \[0, n / 2\)          |
| n \- 1  | \[0, \(n \- 1\) / 2\] | \[0, \(n \- 1\) / 2\] |
| n \+ 1  | \[0, \(n \+ 1\) / 2\) | \[0, \(n \+ 1\) / 2\) |

可以看到, 只要做1的偏移后, 区间的开闭情况对于odd和even就是统一的了.

原因在于, `+1`和`-1`的变化, 对于odd和even, 只会有1种变化产生影响. 那么变化之后方括号和圆括号就只剩1种了.

以上可以写成一个宏来方便遇到类似的情况不会使代码写错.

## 线段树使用2n空间, 直接根据区间端点算出结点编号

线段树(指普通版本)使用2n空间, 这是我会写指针版本线段树之后一直认为的很好的写法, 只要手动维护结点编号的分配即可.

什么, 你说zkw线段树? 那种东西并不够通用, 弃之.

但是, 指针版本的线段树, 需要保存左右结点的地址, 对于卡空间的出题人(2020计蒜之道初赛某场)来说, 卡掉指针写法是他们的基本操作.

有一天我看到一份代码, 发现不需要手动维护结点编号, 也能做到2n空间的线段树, 而且是直接根据区间端点算出结点编号, 我当时就惊了, 还有这种操作.jpg.

这个东西我不知道出处是哪里, 有知道的人可以告诉我一下.

---

程序是`seg2n_idx.cpp`.

我们先约定线段树中我们表示线段(区间)的端点形式是左闭右闭.

那么对于奇数段, 有2种划分子段的形式:

1. 多余的1个单位放在左边段.
2. 多余的1个单位放在右边段.

以上2种划分方式, 对应了线段树的2种编号方式.

直接看图, 然后找规律.

图...待补充.